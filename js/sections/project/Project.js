"use strict";import EventfulClass from"../../lib/EventfulClass.js";import{getProjects}from"../../lib/Utils.js";import{bulkNodeAction,getProjectByStringID,isDesktop,throttle,appearOutphased}from"../../lib/Utils.js";import{slideImages,changeExtraBtnTxtToMinus,changeMinusBtnTxtToExtra}from"./ProjectVisualEffectsUtils.js";import VideoHandler from"./VideoHandler.js";class Project extends EventfulClass{init(e){this.id=window.location.hash,getProjects(e).then(e=>{this.info=getProjectByStringID(this.id.substring(1),e),this.info?this.populateData():window.location="/"}),this.isDesktop=isDesktop(),this.nodes=this.getNodes(),this.removeSetupNodes(),this.addSetupEvents()}getNodes(){var e={};return e.container=document.querySelector(".project-container"),e.name=document.getElementById("project-name"),e.type=document.getElementById("project-type"),e.typeLink=e.type.querySelector("a"),e.listContainer=document.getElementById("project-list-container"),e.list=document.getElementById("project-list"),e.listItem=e.list.querySelector("li"),e.gallery=document.getElementById("project-gallery"),e.galleryItem=e.gallery.querySelector("li"),e.extraInfo=document.getElementById("extra-info-sec"),e.extraInfoBtn=document.getElementById("extra-info-sec-btn"),e.nextBtn=document.getElementById("next-btn"),e.lastBtn=document.getElementById("last-btn"),e.closeBtn=document.getElementById("close-btn"),e.year=document.getElementById("project-year"),e.via=document.getElementById("project-via"),e.participation=document.getElementById("project-participation"),e.about=document.getElementById("project-about"),e.technically=document.getElementById("project-technically"),e.curious=document.getElementById("project-curious"),e.galleryContainer=document.getElementById("project-gallery-container"),e.fakeVideoContainer=document.getElementById("fake-video-container"),e.video=document.getElementById("project-video"),e.videoContainer=document.getElementById("video-container"),e.overlay=document.getElementById("info-overlay"),e}removeSetupNodes(){bulkNodeAction("remove",[this.nodes.typeLink,this.nodes.list,this.nodes.listItem,this.nodes.gallery,this.nodes.galleryItem])}addSetupEvents(){this.nodes.extraInfoBtn.addEventListener("click",this.onExtraInfoClick.bind(this)),this.nodes.nextBtn.addEventListener("click",this.onGoToProject.bind(this)),this.nodes.lastBtn.addEventListener("click",this.onGoToProject.bind(this)),this.nodes.closeBtn.addEventListener("click",this.onCloseProjects.bind(this))}hasVideo(){return this.info.video&&5<this.info.video.length}shouldShowVideo(){return isDesktop()}populateData(){this.populateMainInfo(),this.populateNavButtons(),this.populateExtrainfo(),this.populateFactsList(),this.populateImagesOrVideo(),this.throttledResize=throttle(this.onResize.bind(this)),window.addEventListener("resize",this.throttledResize)}populateMainInfo(){this.nodes.name.innerHTML=this.info.name,this.nodes.type.innerHTML=this.info.type,this.info.urls[0]&&(this.nodes.typeLink.setAttribute("href",this.info.urls[0]),this.nodes.type.append(this.nodes.typeLink))}populateNavButtons(){this.nodes.lastBtn.setAttribute("data-id",this.info.lastProject.stringID),this.nodes.lastBtn.querySelector(".title").innerHTML=this.info.lastProject.name,this.nodes.nextBtn.setAttribute("data-id",this.info.nextProject.stringID),this.nodes.nextBtn.querySelector(".title").innerHTML=this.info.nextProject.name}populateExtrainfo(){this.nodes.year.innerHTML=this.info.year,this.nodes.via.innerHTML=this.info.via,this.nodes.participation.innerHTML=this.info.participation,this.nodes.about.innerHTML=this.info.about.replace(/\n/g,"</p><p>"),this.nodes.technically.innerHTML=this.info.technically,this.nodes.curious.innerHTML=this.info.curious}populateFactsList(){var t;for(let e=0;e<this.info.list.length;e++)(t=this.nodes.listItem.cloneNode(!0)).querySelector("i").classList.add("fa-"+this.info.list[e].icon),t.append(this.info.list[e].info),this.nodes.list.append(t);this.nodes.listContainer.append(this.nodes.list)}populateImages(){var t;for(let e=0;e<this.info.images.detail.length;e++)(t=this.nodes.galleryItem.cloneNode(!0)).classList.add("unshown"),t.querySelector("img").setAttribute("src","images/projects/"+this.info.images.detail[e]),this.nodes.gallery.append(t);appearOutphased(this.nodes.gallery.children,1e3),this.nodes.galleryContainer.append(this.nodes.gallery)}populateImageBackground(){this.nodes.fakeVideoContainer.setAttribute("src","images/projects/"+this.info.images.detail[0]),this.nodes.fakeVideoContainer.classList.add("unshown"),this.nodes.fakeVideoContainer.classList.remove("hidden"),setTimeout(()=>{this.nodes.fakeVideoContainer.classList.remove("unshown")},100)}populateVideo(){this.videoId=this.info.video.substr(this.info.video.indexOf("embed/")+6),this.videoHandler=new VideoHandler(this.nodes.videoContainer,this.videoId)}populateVideoAlternative(){this.nodes.fakeVideoContainer.classList.add("hidden"),this.nodes.videoContainer.classList.add("video-container"),this.sliderInterval=slideImages(this.nodes.videoContainer,this.nodes.container,this.info.images.detail)}populateImagesOrVideo(){this.hasVideo()&&this.shouldShowVideo()?this.populateVideo():this.shouldShowVideo()?this.populateVideoAlternative():(this.populateImages(),this.populateImageBackground())}onResize(){this.isDesktop!==isDesktop()&&(this.destroyVideo(),this.destroyImageSlider(),this.nodes.gallery.innerHTML="",this.populateImagesOrVideo(),this.isDesktop=isDesktop())}onExtraInfoClick(e){e=e.currentTarget;e.disabled||(e.disabled=!0,this.nodes.extraInfo.classList.contains("unshown")?this.showExtraInfo(e):this.hideExtraInfo(e))}showExtraInfo(e){this.nodes.overlay.classList.remove("hidden"),this.nodes.extraInfo.classList.remove("hidden");const t=this.nodes.extraInfo.offsetTop;changeExtraBtnTxtToMinus(this.nodes.extraInfoBtn),setTimeout(()=>{this.nodes.overlay.classList.remove("unshown"),window.scrollTo({top:t,behavior:"smooth"})},100),setTimeout(()=>{this.nodes.extraInfo.classList.remove("unshown"),e.disabled=!1},500)}hideExtraInfo(e){this.nodes.extraInfo.classList.add("unshown"),window.scrollTo({top:0,behavior:"smooth"}),changeMinusBtnTxtToExtra(this.nodes.extraInfoBtn),setTimeout(()=>{this.nodes.overlay.classList.add("unshown")},500),setTimeout(()=>{isDesktop()&&this.nodes.overlay.classList.add("hidden"),this.nodes.extraInfo.classList.add("hidden"),e.disabled=!1},1e3)}onGoToProject(e){this.trigger("openProject",e.currentTarget.getAttribute("data-id"))}onCloseProjects(e){e.currentTarget.setAttribute("href","proyectos.html"),this.trigger("openProjects")}destroy(){this.destroyVideo(),this.destroyImageSlider(),window.removeEventListener("resize",this.throttledResize)}destroyVideo(){this.videoHandler?.destroy()}destroyImageSlider(){clearInterval(this.sliderInterval)}}const projectSingleton=new Project;export default projectSingleton;