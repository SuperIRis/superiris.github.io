"use strict";import{getProjects,preloadImage}from"../lib/Utils.js";import ScrollMonitor from"../vendor/scrollMonitor.js";import AnimatedJsonSprite from"../lib/AnimatedJsonSprite.js";import EventfulClass from"../lib/EventfulClass.js";import{trackEvent}from"../lib/Utils.js";const PROJECTS=[];class Home extends EventfulClass{init(e){this.setHomeAnimation(),getProjects(e).then(e=>{this.projects=e.filter(e=>e.images&&e.images.home),this.setProjects()}),document.getElementById("home-down-btn").addEventListener("click",this.onScrollToProjects)}onScrollToProjects(){var e=document.getElementById("intro-container").offsetHeight+86;window.scrollTo({top:e,behavior:"smooth"})}setHomeAnimation(){var e=["libro","normal","ds"],e=e[Math.floor(Math.random()*e.length)];this.homeMe=new AnimatedJsonSprite("spritesheets/homes-"+e+".png",document.getElementById("me"),{loop:!0,frameRate:40}),this.homeMe.start()}setProjects(){var e=document.querySelectorAll("#projects-preview-list li");this.loadedProjects=0,e.forEach(this.populateProjectData.bind(this))}populateProjectData(e,t){e.querySelector(".project-title").innerHTML=this.projects[t].name,e.querySelector(".project-tech").innerHTML=this.projects[t].tech,e.querySelector("a").setAttribute("data-project",this.projects[t].stringID),e.querySelector("a").addEventListener("click",this.onProjectClick.bind(this)),preloadImage("images/projects/"+this.projects[t].images.home).then(()=>{this.onProjectImageLoaded(e,t)})}onProjectImageLoaded(e,t){e.querySelector(".project-preview-item").style.backgroundImage=`url(images/projects/${this.projects[t].images.home})`,e.classList.remove("loading"),this.loadedProjects++,this.loadedProjects===this.projects.length&&this.setScrollMonitor()}setScrollMonitor(){this.projectsWatcher=ScrollMonitor.create(document.querySelectorAll("#projects-preview-list li")[0],-10),this.projectsWatcher.enterViewport(function(){document.getElementById("projects-preview-list").classList.remove("unshown")}),this.projectsWatcher.exitViewport(function(){document.getElementById("projects-preview-list").classList.add("unshown")})}onProjectClick(e){e.preventDefault(),this.homeMe.stop(),this.trigger("openProject",e.currentTarget.getAttribute("data-project"))}destroy(){this.homeMe=null,this.projectsWatcher.destroy(),this.loadedProjects=0}}const homeSingleton=new Home;export default homeSingleton;