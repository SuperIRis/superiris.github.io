"use strict";import EventfulClass from"./EventfulClass.js";import{onAllImagesLoaded}from"./Utils.js";class AnimatedLoader extends EventfulClass{getNodes(){return{body:document.querySelector("body"),loader:document.getElementById("loader"),mainHeader:document.querySelector(".main-header"),mainFooter:document.querySelector(".main-footer"),mainWrapper:document.getElementById("main-wrapper"),mainContainer:document.querySelector("#main-container"),pusher:document.getElementById("pusher")}}init(e,t){if(!e)return console.error("AnimatedLoader needs an animation from AnimatedJsonSprite");this.animation=e,this.libraries=t,this.animation.start()}showLoader(){this.nodes.loader.classList.remove("unshown"),this.nodes.body.classList.add("scroll-block"),setTimeout(()=>{this.animation.start()},700)}hideLoader(){this.nodes.body.classList.remove("scroll-block"),this.animation.stop(),setTimeout(()=>{this.nodes.loader.classList.add("unshown")},700)}cleanPageState(){document.querySelector(".selected")?.classList.remove("selected")}loadSection(e,t={}){if(!this.animation)return console.error("AnimatedLoader hasn't been initiated");var{browserNav:t=!1,changeLanguage:n=!1}=t;this.browserNav=t,this.changeLanguage=n,this.nodes=this.getNodes(),this.url=e,this.loadReady=!1,this.animationReady=!1,this.showLoader(),fetch(this.url).then(e=>e.text()).then(this.onSectionDOMReady.bind(this)),setTimeout(()=>{this.animationReady=!0,this.loadReady&&this.onLoadReady(),this.cleanPageState()},1e3)}onSectionDOMReady(e){this.loadReady=!0,this.htmlData=e,this.animationReady&&this.onLoadReady()}onLoadReady(){setTimeout(()=>{const t=document.createElement("div"),n=(t.innerHTML=this.htmlData,t.querySelector("title").innerHTML);this.nodes.mainContainer.innerHTML=t.querySelector("#main-container").innerHTML,this.changeLanguage&&(this.nodes.mainHeader.innerHTML=t.querySelector(".main-header").innerHTML,this.nodes.mainFooter.innerHTML=t.querySelector(".main-footer").innerHTML),onAllImagesLoaded(t.querySelector("#main-container")).then(()=>{var e;this.animationReady&&(e=t.querySelectorAll("script"),document.title=n,window.history.pushState&&!this.browserNav&&window.history.pushState(n,n,this.url),this.loadScriptsIfNeeded(e).then(()=>{this.trigger("done",this.url),this.hideLoader()}))})},1e3)}loadScriptsIfNeeded(e){const n=[];return e.forEach(t=>{var e=this.libraries.find(e=>-1!==t.src.indexOf(e.script));e&&!window[e.globalName]&&n.push(this.loadScript(t.src))}),Promise.all(n)}loadScript(i){return new Promise((e,t)=>{var n=document.createElement("script");document.body.appendChild(n),n.onload=e,n.onerror=t,n.async=!0,n.src=i})}}const AnimatedLoaderSingleton=new AnimatedLoader;export default AnimatedLoaderSingleton;